<html xmlns="http://www.w3.org/1999/xhtml" data-reactroot=""><head><meta charSet="utf-8"/><title>2018-12-31</title><link rel="stylesheet" type="text/css" href="../css/normalize.css"/><link rel="stylesheet" type="text/css" href="../css/markdown.css"/><link rel="stylesheet" type="text/css" href="../css/customer.css"/><link rel="stylesheet" type="text/css" href="../css/bootstrap.css"/></head><body><div class="container"><div class="mblog-container"><div class="card m-panel card9 weibo-member card-vip"><div class="card-wrap"><div class="card-main"><header class="weibo-top m-box m-avatar-box"><a class="m-img-box"><div class="duokan-image-single"><img src="../image/347e4d367fc667cad0608d396bfd47aa_／orj480／42ba230cly8g8kktbreuxj20u00u0tbh.jpg"/></div><i class="m-icon m-icon-goldv-static"></i></a><div class="m-box-col m-box-dir m-box-center"><div class="m-text-box"><a><h3 class="m-text-cut">斯图亚特9<!-- --> <i class="m-icon m-icon-vipl7"></i></h3></a><h4 class="m-text-cut"><span class="time">2018-12-31</span></h4></div></div></header><article class="weibo-main"><div class="weibo-og"><div class="weibo-text">少华多次耐心为我解惑各种Linux内核问题，也是和我们有过短暂合作关系的伙伴。这实在是太可惜了。愿他在天国可以继续纯粹地做技术<span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/54bfaff7b51523a83f1ca395bb3b97f0_／m／emoticon／icon／others／o_lazhu-afb8e4fbdc.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/54bfaff7b51523a83f1ca395bb3b97f0_／m／emoticon／icon／others／o_lazhu-afb8e4fbdc.png" style="width:1em; height:1em;"/></div></span>//<a href='/n/刘松braving'>@刘松braving</a>:少华是我进入内核开发的引路人。愿天国没有病痛，只有代码<span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span></div></div><div class="weibo-img-list-container"><div class="weibo-media-wraps weibo-media media-b"><ul class="m-auto-list"></ul></div></div><div class="weibo-article-container"></div><div class="weibo-rp"><div class="weibo-text"><span><a href="https://m.weibo.cn/u/1989691335?uid=1989691335&amp;luicode=10000011&amp;lfid=2304131119494924_-_WEIBO_SECOND_PROFILE_WEIBO">@<!-- -->Coly_Li</a>:</span><div>重要的Linux内核开发者，MD子系统维护者李少华于2018年12月28日因病离开了我们。心痛无比，含泪写了这篇短文，追忆我们一起拼搏的青春，纪念我的好朋友。<span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/bbc8d007481a2765d4456f5a17310a2e_／m／emoticon／icon／default／d_lei-4cdf6ee412.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/54bfaff7b51523a83f1ca395bb3b97f0_／m／emoticon／icon／others／o_lazhu-afb8e4fbdc.png" style="width:1em; height:1em;"/></div></span><span class="url-icon"><div class="duokan-image-single"><img src="../image/54bfaff7b51523a83f1ca395bb3b97f0_／m／emoticon／icon／others／o_lazhu-afb8e4fbdc.png" style="width:1em; height:1em;"/></div></span> <a  href="https://weibo.com/ttarticle/p/show?id=2309404323330038621366" data-hide=""><span class='url-icon'><div class="duokan-image-single"><img src="../image/3b0cd48a4d1146862594012275da45d4_15／09／25／3／timeline_card_small_article_default.png"/></div></span><span class="surl-text">追思心中璀璨的明星：杰出内核开发者李少华</span></a> </div></div><div class="weibo-img-list-container"><div class="weibo-media-wraps weibo-media media-b"><ul class="m-auto-list"></ul></div></div><div class="weibo-article-container"><div class="WB_artical"><div class="article-split-line"></div><div class="main_toppic"><div class="picbox"><div class="duokan-image-single"><img src="../image/9a062665deffca106fcef6ab5d5bedb9_／large／abd13f1bly1fjb28knztnj20ku0bqwh5.jpg"/></div></div></div><div class="main_editor " node-type="articleContent"><div class="title" node-type="articleTitle">追思心中璀璨的明星：杰出内核开发者李少华</div><div class="art-line"></div><div class="WB_editor_iframe_new" node-type="contentBody"><div class="article-content"><p align="justify">​2018年最后一天，今天在商场溜娃，忽然看到少华妻子的朋友圈提到李少华于12月28日离开了我们。我知道少华前阵子身体不好但有好转，这心痛的消息来得太突然，眼泪一下就出来了。家人也发现了我忽然情绪低沉，我忍不住眼泪颤抖的说“少华走了”。</p>
<p align="justify">李少华是我们这一辈Linux内核开发者之中的杰出代表，应该说是目前华人圈最优秀和最重要的Linux内核开发者之一，他除了是内核子系统MD（软raid）的维护者之外，在块设备层，I/O调度器，NVMe，内存管理，电源管理等领域都做出了非常重要的工作。​他的代码和对内核的改进，融合在整个内核在IO和存储站的方方面面，真的是通过很具体的工作，贡献了正能量，让这世界变得更美好了些许。</p>
<p align="justify">和少华家人联系后得知，在最后的时候，少华还时不时的提起“我有了一个新的想法”，“这段代码路径还可以再优化改进”。这是一个多么纯粹的人，对系统软件技术充满的虔诚的纯真的热爱，我心想恐怕也只有这般专注，才能成为一个改变世界的人。很多人活一辈子，恐怕也没有少华这三十几年来的闪亮和耀眼。一辈子活成这样，从个人来说，没有遗憾，是我们心目中的英雄！</p>
<p align="justify">我和少华最直接的工作交集，我印象最深的有两件事情。</p>
<p align="justify">第一件事情是我在解决MD raid1在NVMe SSD上的读写性能瓶颈时，少华认为我的修改可能会在多层MD设备堆叠的时候引入死锁，而我认为不会。我们在邮件列表里来回讨论了很多次，他指导我来理解MD代码中的一些细节，最终我们发现MD raid1在发射IO的时候会从另外一个raid1d()线程来处理，所以不会在generic_make_request()里面发生死锁，少华鼓励我“这是很好的讨论”，然后接受了我的patch。而后来少华还发现了我的patch里的其他问题，直接就修掉了。在少华的帮助下，除了我们将MD raid1的读性能提升了好几倍之外，我也对MD的基本原理有了更深刻的认识。</p>
<p align="justify">第二件事情是有用户报告MD raid0在NVMe SSD上做trim的时候时间非常久，我自己测试在15T的NVMe raid0设备上格式化xfs文件系统（加trim）需要300多秒，绝大多数时间都用在trim这里了，这是很不正常的。少华分析这是因为raid0会将上层发来的discard bio按照stripe大小做切分，然后再发送到raid0组成的不同硬盘上去，所以当raid0容量比较大的时候，原本的一个discard bio可能会被切分成几百甚至上千万个小bio来处理，这性能一下就降低了。​我们的思路是将切分后的bio再根据每一个raid0的组件设备拼接起来，最后可以组成连续的一个或者极少数几个bio，然后再将拼接后的bio发送到每一个组件设备上去，这样就可以降低几百万个bio了。我先写了一个很复杂的patch，来准确的将所有切分的bio按照每个设备一个bio的方式拼接起来。虽然拼接出来的bio最少，但是代码非常难读懂。少华后来做了一个实现，大概几十行代码，做了一个次优化版本：</p>
<p><div class="duokan-image-single"><img src="../image/d44dc3ee87c3495a6a3660c13a91cad5_／large／769847c7ly1fypz9oq2xwj20u017ghdt.jpg" alt="raid0_handle_discard()核心代码片段"/></div></p>
<p align="justify">少华的代码，通过一个很优雅的循环，就完成了将分布在不同组件设备上的bio的拼接，并且在绝大多数通常情况下，拼接效果和我的复杂代码一样，速度还更快！最后我测试出来，少华的这个代码可以将在raid0上格式化xfs文件系统的速度从300多秒降低到20多秒。当我阅读少华的patch时，心中充满的欣赏和愉悦，能看到一段更优雅和高效的代码，真的是非常愉悦的事情，而且这种好心情可以持续很久，每每想起都会觉得开心。</p>
<p align="justify">再后来我接受了bcache子系统的维护工作，和少华一起密切合作的机会就少了很多。但我一直在关注他在内核里的工作，看到他继续在做的很多优秀的工作。非常切合实际的说，少华是为Linux内核做贡献的最杰出和最重要的中国人之一，从全球华人的范围来看他的工作重要性也能够进入前20位。而他还这么年轻，还不到40岁，实在是我们这辈人之中的璀璨明星，能和他一起工作是我的骄傲和荣幸！</p>
<p align="justify">在写这些文字的时候，不禁回想起从最初认识少华，那时他在Intel OTC我在SUSE Labs，他在做性能相关，我在做文件系统。然后2009 年我们在CLSF[1]会议上第一次见面，然后2010年他和其他Intel朋友一起帮忙在Intel紫竹园区举行第二届CLSF。再后来他离开了Intel去了存储领域创新独角兽公司Fusion IO，在PCIe SSD、IO调度器和块设备层做了大量的优秀工作。在我加入阿里组建淘宝内核组的时候，他已经决定去Facebook内核团队，和Jens Axboe, Chiris Mason, Tanjun Heo等国际顶级内核黑客一起工作，很遗憾没有机会和他做同事。少华一直是我们这一批人中最耀眼最杰出的极少数几个人。我在2016年遇到参加Kernel Summit的Tanjun Heo的时候，他特意反复几次的提到，少华非常优秀，在块设备层做了很多优秀的工作。能够被顶级黑客这样评价的人，少之又少，而我认识的国人之中大概也就两三个人吧。当时我意识到，经过长期不懈的努力工作，在Linux内核开发领域，少华已经跻身全球最好的IO栈开发者之列了。</p>
<p align="justify">从git log里看到少华的大量的贡献，我感觉到少华虽然人离开了我们，但是他的代码，仍然散发着他的才华，继续在为世界做贡献。在今后的工作中，我们还会继续阅读他的代码，就像和他在谈心，对于熟悉他的人而言，这虽然心酸，也是和老朋友对话的最好的方式。而我也知道，他的代码以及他所维护的MD子系统，在工业届被广泛应用。譬如现在火热的PD-1/PD-L1生物制药领域，通过大数据的方式来分析DNA特征，其中的信息处理系统中Linux内核和高性能IO栈肯定被广泛的使用到了。少华虽然离开了我们，他为这个世界留下的贡献，仍然在为创造更美好的世界发挥价值。</p>
<p align="justify">我们都会离开这个世界，或早或晚，命不在长短而在价值，活得有价值是很幸运的。很痛心少华过早的离开了我们，但我也很羡慕他的人生活出了精彩，他自己的不懈奋斗为这操蛋的世界带来了更多的光亮。这光亮，对家人对朋友，都是鼓励和激励，让我们继续在这操蛋的世界里，为更好的世界努力不懈，也享受生活中点滴的幸福。感激少华，你短暂的一生所创造的温暖和快乐，让我感受到这世界多一点的善意和希望。​</p>
<p align="justify"><br/></p>
<p align="justify">CLSF[1]: China Linux Storage, Memory management &amp; File system Workshp​​​​</p></div><div class="DCI_v2 clearfix"></div></div></div></div></div></div></article><footer class="m-ctrl-box m-box-center-a"><div class="m-diy-btn m-box-col m-box-center m-box-center-a m-box-center-retweet"><i class="m-font m-font-forward lite-iconf lite-iconf-report"></i><h4>5</h4></div><span class="m-line-gradient"></span><div class="m-diy-btn m-box-col m-box-center m-box-center-a m-box-center-comment"><i class="m-font m-font-comment  lite-iconf lite-iconf-comments"></i><h4>8</h4></div><span class="m-line-gradient"></span><div class="m-diy-btn m-box-col m-box-center m-box-center-a m-box-center-agree"><i class="m-icon m-icon-like lite-iconf lite-iconf-like"></i><h4>1</h4></div></footer></div></div></div><hr/></div><div><div class="footer-container"><div class="action action-go-back "><a href="./2018-12-30.html">上一页</a></div><span class="gradient"></span><div class="action action-go-category"><a href="./index.html">目录</a></div><span class="gradient"></span><div class="action action-go-next "><a href="./2019-01-02.html">下一页</a></div></div><div class="footer-container-placeholder"></div></div></div></body></html>